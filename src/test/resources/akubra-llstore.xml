<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

    <bean name="org.fcrepo.server.storage.lowlevel.ILowlevelStorage"
          class="org.fcrepo.server.storage.lowlevel.akubra.AkubraLowlevelStorageModule">
        <constructor-arg index="0">
            <map />
        </constructor-arg>
        <constructor-arg index="1" ref="org.fcrepo.server.Server" />
        <constructor-arg index="2" type="java.lang.String"
                         value="org.fcrepo.server.storage.lowlevel.ILowlevelStorage" />
        <property name="impl"
                  ref="org.fcrepo.server.storage.lowlevel.akubra.AkubraLowlevelStorage" />
    </bean>

    <bean
            name="org.fcrepo.server.storage.lowlevel.akubra.AkubraLowlevelStorage"
            class="org.fcrepo.server.storage.lowlevel.akubra.AkubraLowlevelStorage"
            singleton="true">
        <constructor-arg>
            <description>The store of serialized Fedora objects</description>
            <ref bean="tapeObjectStore" />
        </constructor-arg>
        <constructor-arg>
            <description>The store of datastream content</description>
            <ref bean="datastreamStore" />
        </constructor-arg>
        <constructor-arg value="false">
            <description>if true, replaceObject calls will be done in a way
                that
                ensures the old content is not deleted until the new content is safely
                written. If the objectStore already does this, this should be
                given as
                false</description>
        </constructor-arg>
        <constructor-arg value="true">
            <description>save as above, but for datastreamStore</description>
        </constructor-arg>
    </bean>
    <!--
      <bean name="objectStore" class="org.akubraproject.map.IdMappingBlobStore"
        singleton="true">
        <constructor-arg value="urn:example.org:objectStore" />
        <constructor-arg>
          <ref bean="tapeObjectStore" />
        </constructor-arg>
        <constructor-arg>
          <ref bean="fsObjectStoreMapper" />
        </constructor-arg>
      </bean>
    -->


    <bean name="tapeObjectStore" class="dk.statsbiblioteket.metadatarepository.xmltapes.XmlTapesBlobStore"
          singleton="true">
        <constructor-arg value="urn:example.org:tapeObjectStore" />
        <property name="archive" ref="tarTapeObjectStore"/>

    </bean>

    <bean name="tarTapeObjectStore" class="dk.statsbiblioteket.metadatarepository.xmltapes.ZipArchive" init-method="init"
          singleton="true">
        <constructor-arg value="file:/home/abr/fcrepo362/data/tapeObjectStore" type="java.net.URI"/>
        <constructor-arg value="10485760" type="long"/>  <!--10 MB-->
        <property name="index" ref="redisIndex"/>
    </bean>


    <bean name="redisIndex" class="dk.statsbiblioteket.metadatarepository.xmltapes.redis.RedisIndex"
          singleton="true">
        <constructor-arg value="localhost" />
        <constructor-arg value="6379"/>
    </bean>


    <bean name="datastreamStore" class="org.akubraproject.map.IdMappingBlobStore"
          singleton="true">
        <constructor-arg value="urn:fedora:datastreamStore" />
        <constructor-arg>
            <ref bean="fsDatastreamStore" />
        </constructor-arg>
        <constructor-arg>
            <ref bean="fsDatastreamStoreMapper" />
        </constructor-arg>
    </bean>

    <bean name="fsDatastreamStore" class="org.akubraproject.fs.FSBlobStore"
          singleton="true">
        <constructor-arg value="urn:example.org:fsDatastreamStore" />
        <constructor-arg value="/home/abr/fcrepo362/data/datastreamStore"/>
    </bean>

    <bean name="fsDatastreamStoreMapper"
          class="org.fcrepo.server.storage.lowlevel.akubra.HashPathIdMapper"
          singleton="true">
        <constructor-arg value="##" />
    </bean>

    <bean name="fedoraStorageHintProvider"
          class="org.fcrepo.server.storage.NullStorageHintsProvider"
          singleton="true">
    </bean>

</beans>